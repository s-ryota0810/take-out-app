.shop
  .shop_detail
    .shop_detail_main
      - if user_signed_in? && current_user.admin?
        .shop_detail_main_edit
          %ul
            %li= link_to '編集', edit_shop_path(@shop)
            %li= link_to '削除', shop_path, data: { confirm: '削除しますか？', method: 'delete' }
      - elsif user_signed_in?
        .shop_detail_main_edit
          .favorite
            - if current_user.has_favorited?(@shop)
              .with_favorited
                = link_to 'お気に入り解除', shop_favorites_path(@shop), method: :delete
            -else
              .non_favorited
                = link_to 'お気に入り登録', shop_favorites_path(@shop), method: :post
      .shop_detail_name
        %h1= @shop.name
      .shop_detail_image
        = image_tag @shop.shop_image
      .shop_detail_review
        %p 星4つ
    .shop_detail_sub
      .shop_detail_sub_menu
        .shop_detail_sub_menu_el
          = link_to 'メニュー', '#'
        .shop_detail_sub_menu_el
          = link_to 'アクセス', '#'
        .shop_detail_sub_menu_el
          = link_to '口コミ', '#'
      .shop_detail_description
        .shop_detail_description_el
          %h2 メニュー一覧
          - @menus.each do |menu|
            .show_menu
              %dl.show_menu_info.clearfix
                %dt.menu_name= menu.name
                %dd.menu_price¥#{menu.price}
                - if user_signed_in? && current_user.admin?
                  .edit_menus
                    = link_to '編集', edit_shop_menu_path(@shop)
                    = link_to '削除', shop_menu_path(@shop, menu), data: { method: 'delete', confirm: 'メニュー情報を削除しますか'}
          - if user_signed_in? && current_user.admin?
            .new_menus
              = link_to 'メニューの追加', new_shop_menu_path(@shop)
        .shop_detail_description_el
          %h2 アクセス
          .show_access
            .show_access_map
              #map
              - google_api = "https://maps.googleapis.com/maps/api/js?key=#{ENV['GOOGLE_MAP_API']}&callback=initMap".html_safe
              %script{:async => "", :src=> google_api}
            .show_access_info
          
          :javascript
            let map;
            function initMap(){
              geocoder = new google.maps.Geocoder()
              
              map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 35.689607, lng:139.700571 },
                zoom: 12,
              });
              
              marker = new google.maps.Marker({
                position: { lat: 35.689607, lng:139.700571 },
                map: map
              });
            }
        .shop_detail_description_el
          %h2 クチコミ一覧
          - @comments.each do |comment|
            .show_comment
              .show_comment_info
                .show_comment_title
                  = comment.title
                .show_comment_user
                  = comment.user.display_name
              .show_comment_content
                = comment.content
              .show_comment_star
                %div{:id => "star-rate#{comment.id}"}
                :javascript
                  $('#star-rate#{comment.id}').raty({
                    size :36,
                    starOff :'#{asset_path("star-off.png")}',
                    starOn  :'#{asset_path("star-on.png")}',
                    starHalf:'#{asset_path("star-half.png")}',
                    score   : '#{comment.star}',
                    half    : true,
                    readOnly: true,
                  });
          - if user_signed_in?
            .new_comment
              = link_to 'クチコミの追加', new_shop_comment_path(@shop)